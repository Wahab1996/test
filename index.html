<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>جرعتي – حاسبة جرعات الأدوية</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #f0f4f8;
      color: #333;
      padding: 20px;
      margin: 0;
    }
    h1, h2 {
      color: #007bff;
      text-align: center;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      margin-top: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      background-color: #e7f3ff;
      border: 1px solid #b3daff;
      border-radius: 8px;
      font-weight: bold;
    }
    .signature {
      margin-top: 30px;
      font-size: 14px;
      text-align: center;
      color: #555;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>💊 تطبيق جرعتي</h1>
    <p style="text-align:center;">حاسبة جرعات أدوية الأطفال حسب الوزن</p>

    <label for="weight">وزن الطفل (كجم):</label>
    <input type="number" id="weight" placeholder="مثال: 12">

    <label for="drug">اختر الدواء:</label>
    <select id="drug"></select>

    <button onclick="calculateDose()">احسب الجرعة</button>
    <button onclick="copyDose()">📋 نسخ الجرعة</button>
    <button onclick="showMlDose()">💧 عرض الجرعة بالمل</button>

    <div id="result" class="result" style="display:none;"></div>

    <div class="signature">
      تم بواسطة: د. عبدالوهاب عبد المنان الشيخ – طبيب طوارئ أطفال، طموح طبيب أسرة<br>
      مطور تطبيق جرعتي<br>
      المراجع العلمية: UpToDate , BMJ , AMBOSS , SAUDI GUIDELINES , MEDSCAPE
    </div>
  </div>

  <script>
    const drugs = [
      { scientific: "Paracetamol", trade: "سيتال", dose: "10–15", unit: "مجم", interval: "كل 6–8 ساعات", max: 60, concentration: 120 },
      { scientific: "Ibuprofen", trade: "بروفين", dose: "5–10", unit: "مجم", interval: "كل 6–8 ساعات", max: 40, concentration: 100 },
      { scientific: "Azithromycin", trade: "زيثروماكس", dose: "10", unit: "مجم", interval: "مرة يومياً لمدة 3 أيام", max: 500, concentration: 200 },
      { scientific: "Ceftriaxone", trade: "روسبين", dose: "50–100", unit: "مجم", interval: "مرة يومياً", max: 2000 },
      { scientific: "Ondansetron", trade: "زوفران", dose: "0.15", unit: "مجم", interval: "عند اللزوم", max: 8, concentration: 2 }
    ];

    const select = document.getElementById("drug");
    drugs.forEach((drug, i) => {
      const option = document.createElement("option");
      option.value = i;
      option.textContent = `${drug.scientific} – ${drug.trade}`;
      select.appendChild(option);
    });

    let currentDoseText = "";

    function calculateDose() {
      const weight = parseFloat(document.getElementById("weight").value);
      const drugIndex = document.getElementById("drug").value;
      const resultDiv = document.getElementById("result");

      if (!weight || weight <= 0 || drugIndex === "") {
        resultDiv.style.display = "block";
        resultDiv.innerHTML = "❌ الرجاء إدخال وزن صحيح واختيار دواء.";
        return;
      }

      const d = drugs[drugIndex];
      let doseText = "";
      let range = d.dose.split("–");

      if (range.length === 2) {
        const min = (parseFloat(range[0]) * weight).toFixed(1);
        const max = (parseFloat(range[1]) * weight).toFixed(1);
        doseText = `${min} – ${max} ${d.unit} ${d.interval}`;
      } else {
        const amount = (parseFloat(range[0]) * weight).toFixed(1);
        doseText = `${amount} ${d.unit} ${d.interval}`;
      }

      doseText += `<br>⚠️ الحد الأقصى للجرعة اليومية: ${d.max} ${d.unit}`;

      currentDoseText = doseText.replace(/<br>/g, "\n"); // for copying
      resultDiv.innerHTML = `✅ الجرعة المحسوبة:<br><strong>${doseText}</strong>`;
      resultDiv.style.display = "block";
    }

    function copyDose() {
      if (currentDoseText) {
        navigator.clipboard.writeText(currentDoseText);
        alert("✅ تم نسخ الجرعة إلى الحافظة");
      } else {
        alert("❗ الرجاء حساب الجرعة أولاً");
      }
    }

    function showMlDose() {
      const weight = parseFloat(document.getElementById("weight").value);
      const drugIndex = document.getElementById("drug").value;
      if (!weight || drugIndex === "") {
        alert("❗ الرجاء إدخال الوزن واختيار دواء");
        return;
      }

      const d = drugs[drugIndex];
      if (!d.concentration) {
        alert("⚠️ لا يتوفر تركيز لهذا الدواء");
        return;
      }

      let range = d.dose.split("–");
      const ml = val => (val * weight / d.concentration).toFixed(2);

      if (range.length === 2) {
        const minMl = ml(parseFloat(range[0]));
        const maxMl = ml(parseFloat(range[1]));
        alert(`💧 الجرعة بالمل:\n${minMl} – ${maxMl} مل`);
      } else {
        const amountMl = ml(parseFloat(range[0]));
        alert(`💧 الجرعة بالمل:\n${amountMl} مل`);
      }
    }
  </script>
</body>
</html>
